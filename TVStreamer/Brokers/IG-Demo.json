{
  "Name": "IG-Demo",
  "Transport": "Http",
  "BrokerTemplate": "CustomLogin",

  "Http": {
    "BaseUrl": "https://demo-api.ig.com/gateway/deal/",
    "DefaultHeaders": {
      "Accept": "application/json; charset=UTF-8",
      "Version": "2",
      "X-IG-API-KEY": "{{Vars.ApiKey}}"
    },
    "TimeoutSeconds": 30
  },
  "Vars": {
    "ApiKey": "78e135616531b9964faef1fb313d259af63c1544",
    "AccessToken": "{{GeneratedAccessToken}}",
    "User": "noamlg35demo",
    "Password": "1qaz@WSX",
    "CST": "",
    "XST": "",
    "AccountId": "",
    "AccountName": "",
    "LightStreamerEndpoint": ""
  },
  "BasePositions": {
    "Method": "GET",
    "Url": "https://demo-api.ig.com/gateway/deal/positions",
    "Headers": {
      "X-IG-API-KEY": "{{Vars.ApiKey}}",
      "CST": "{{Vars.CST}}",
      "X-SECURITY-TOKEN": "{{Vars.XST}}",
      "IG-ACCOUNT-ID": "{{Vars.AccountId}}",
      "Version": "2",
      "Accept": "application/json"
    },
    "JsonPaths": {
      "Array": "positions",
      "DealId": "position.dealId",
      "Epic": "market.epic",
      "Amount": "position.size",
      "OpenLevel": "position.level",
      "Direction": "position.direction",
      "Currency": "position.currency",
      "ScalingFactor": "market.scalingFactor",
      "ValuePerPoint": "position.contractSize"
    }
  },

  "Auth": {
    "Steps": [
      {
        "Request": {
          "Method": "POST",
          "Path": "/session",
          "Headers": {
            "X-IG-API-KEY": "{{Vars.ApiKey}}",
            "Version": "2",
            "Accept": "application/json; charset=UTF-8",
            "Content-Type": "application/json; charset=UTF-8"
          },
          "Body": {
            "identifier": "{{Vars.User}}",
            "password": "{{Vars.Password}}"
          }
        },

        "Extract": {
          "Headers": {
            "CST": "CST",
            "AccessToken": "X-SECURITY-TOKEN",
            "XST": "X-SECURITY-TOKEN"
          },
          "Json": {
            "LightStreamerEndpoint": "lightstreamerEndpoint",
            "AccountId": "currentAccountId"
          }
        },

        "BindDefaults": {
          "Headers": {
            "CST": "{{CST}}",
            "X-SECURITY-TOKEN": "{{XST}}"
          }
        }
      }
    ]
  },

  "Streaming": {
    "Provider": "Lightstreamer",
    "Ls": {
      "Endpoint": "{{Vars.LightStreamerEndpoint}}",
      "AdapterSet": "DEFAULT"
    },

    "Subscriptions": [
      {
        "ReferenceId": "positions",
        "Mode": "DISTINCT",

        "Items": [
          "TRADE:"
        ],
        "Fields": [
          "OPU",
          "WOU",
          "CONFIRMS"
        ],
        "IngestTemplate": {
          "type": "snapshot",
          "broker": "IG",
          "account": "{{Vars.AccountId}}",
          "dealId": "{{item.dealId}}",
          "epic": "IG.{{item.epic}}",
          "direction": "{{item.direction}}",
          "size": "{{item.size}}",
          "openLevel": "{{item.openLevel}}",
          "bid": "{{item.bid}}",
          "ask": "{{item.offer}}",
          "valuePerPoint": "{{item.valuePerPoint}}",
          "currency": "{{item.currency}}"
        }
      }
    ]
  }
}
